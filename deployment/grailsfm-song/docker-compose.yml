services:
  grailsfm-song-db:
    container_name: grailsfm-song-db
    image: mongo:7.0
    ports:
      - "9501:27017"
    environment:
      - MONGO_INITDB_ROOT_PASSWORD=${DB_PASSWORD}
      - MONGO_INITDB_ROOT_USERNAME=${DB_USER}
      - MONGO_INITDB_DATABASE=songdb
    restart: always
    volumes:
      - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
  song-localstack:
    container_name: song-localstack
    image: localstack/localstack
    ports:
      - "9550:4566"
    environment:
      - DOCKER_HOST=unix:///var/run/docker.sock
      - SERVICES=s3
    volumes:
      - ./aws:/etc/localstack/init/ready.d
      - "/var/run/docker.sock:/var/run/docker.sock"
    restart: always
